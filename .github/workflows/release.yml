name: Create and publish image

on:
  push:
    tags:
      - test
      # - v[0-9]+.[0-9]+.[0-9]+

permissions:
  contents: read
  packages: write

jobs:
  build_and_push_vpn_client:
    uses: ./.github/workflows/build-workflow.yml
    with:
      targetDir: vpn-client
      tag: ${{ github.ref_name }}

  test_data_store:
    uses: ./.github/workflows/test-workflow.yml
    with:
      targetDir: data-store

  build_and_push_data_store:
    needs: test_data_store
    uses: ./.github/workflows/build-workflow.yml
    with:
      targetDir: data-store
      tag: ${{ github.ref_name }}
